# 姓名分析功能更新

## 新增功能

在取名建议后，新增了姓名分析功能，允许用户输入心仪的姓名进行详细分析。

## 功能说明

### 1. 交互流程

完整的交互流程现在包括：

1. **输入出生信息** - 计算八字
2. **查看八字分析** - 五行、命格分析
3. **询问是否需要取名建议** - 生成10个名字
4. **询问是否需要姓名分析** - 分析用户提供的姓名

### 2. 姓名分析内容

对用户提供的姓名进行全面分析：

#### 单字分析
- 每个字的五行属性
- 每个字的笔画数（康熙字典）
- 每个字的平仄声调（一声二声为平，三声四声为仄）

#### 八字匹配度

评估姓名与八字的匹配程度：

- **用神匹配**（0-30分）- 是否符合用神五行
- **喜神匹配**（0-20分）- 是否符合喜神五行
- **平仄和谐**（0-15分）- 平仄搭配是否和谐
- **寓意质量**（0-20分）- 寓意是否优美
- **笔画平衡**（0-15分）- 笔画是否平衡

#### 综合评分

满分100分，根据以上5个维度计算。

#### 寓意和出处

- 解释姓名的寓意
- 如果出自经典文献，注明出处

#### 改进建议

如果评分较低，提供具体的改进建议。

#### 总体评价

- **优秀**（≥80分）：匹配度高，寓意美好
- **较好**（60-79分）：匹配度较好，有提升空间
- **一般**（40-59分）：匹配度一般，建议改进
- **较差**（<40分）：匹配度较低，需要改进

## 修改的文件

### 1. `interactive_bazi_with_naming.py`

新增 `analyze_user_name()` 函数，用于分析用户提供的姓名。

主要改动：
- 在取名建议后添加姓名分析询问
- 实现完整的姓名分析功能
- 使用 LLM 进行智能分析

### 2. `GUIDE_INTERACTIVE_SYSTEM.md`

更新文档，添加姓名分析功能说明。

## 使用示例

### 交互示例

```
================================================================================
请输入出生信息（或输入'quit'退出）
================================================================================
示例：1990年3月15日上午10点30分，男

请输入：1990年3月15日上午10点30分，男

【一、八字四柱】
年柱：庚午（金 火）
月柱：己卯（土 木）
日柱：壬子（水 水）
时柱：乙巳（木 火）

【二、五行分析】
五行统计：木:2个, 火:2个, 土:1个, 金:1个, 水:2个
日主强弱：中和
用神推算：用神：金，喜神：土，忌神：木, 火

【三、命格分析】
格局：普通格局
性格：聪明, 灵活, 适应力强, 善变
适合事业：教育, 文化, 艺术, 出版, 林业

================================================================================
是否需要取名建议？(y/n): y
请选择需要取名的人：
1. 男孩
2. 女孩
请选择（1或2）: 1

【四、取名建议】
1. 【铭宇】（míng yǔ）- 双字
   寓意：铭记宇宙
   五行：铭: 金，宇: 土
   平仄：铭: 平，宇: 仄
   笔画：铭: 11画，宇: 6画
   评分：88/100
...

================================================================================
是否有心仪的姓名需要分析？(y/n): y
请输入姓名：铭宇

【姓名分析】
--------------------------------------------------------------------------------
正在分析姓名...
================================================================================

姓名：铭宇（míng yǔ）
总笔画：17画

【单字分析】
  铭
    五行：金
    笔画：11画
    平仄：平
  宇
    五行：土
    笔画：6画
    平仄：仄

【八字匹配度】
  用神匹配：30/30
  喜神匹配：20/20
  平仄和谐：12/15
  寓意质量：18/20
  笔画平衡：13/15
  综合评分：93/100

【匹配结果】
  符合用神

【寓意说明】
  铭记宇宙，胸怀宽广，志向远大

【总体评价】
  ✅ 优秀！铭宇 与八字匹配度很高，寓意美好，是一个很好的名字。

================================================================================
```

## 技术实现

### 核心函数

#### `analyze_user_name(user_name, bazi, wuxing_analysis, llm)`

分析用户提供的姓名：

1. 准备八字分析数据（生肖、日主、用神、喜神、忌神）
2. 构建 LLM prompt，要求进行详细分析
3. 解析 LLM 响应
4. 格式化输出分析结果

### LLM Prompt 设计

Prompt 包含：
- 八字信息（生肖、日主、强弱、用神、喜神、忌神）
- 待分析姓名
- 分析要求（五行、笔画、平仄、匹配度、寓意、出处）
- 评分标准
- JSON 格式要求

## 注意事项

1. **姓名分析基于八字**
   - 所有分析都基于用户的八字信息
   - 考虑用神、喜神、忌神
   - 综合平仄、笔画、寓意等因素

2. **LLM 分析质量**
   - 分析质量取决于 LLM 的理解能力
   - 建议多次运行对比结果
   - 评分仅供参考

3. **姓名分析仅供参考**
   - 最终选择应结合家庭实际情况
   - 建议与家人商量
   - 不应过度依赖单一分析

## 更新文档

- `GUIDE_INTERACTIVE_SYSTEM.md` - 更新使用流程，添加姓名分析说明
- `ADD_NAME_ANALYSIS_FEATURE.md` - 本文档，详细说明姓名分析功能

## 提交信息

```
Add: Name analysis feature for evaluating user-provided names

- Add analyze_user_name() function for detailed name analysis
- Integrate name analysis into interactive flow
- Analyze five elements, strokes, tones, and bazi matching
- Provide comprehensive scoring and suggestions
- Update GUIDE_INTERACTIVE_SYSTEM.md with new feature
- Support interactive name evaluation after naming suggestions
```

## 测试建议

### 测试场景1：完全流程

1. 输入出生信息
2. 查看八字、五行、命格分析
3. 生成取名建议
4. 输入心仪的姓名进行分析

### 测试场景2：仅八字分析

1. 输入出生信息
2. 查看八字、五行、命格分析
3. 跳过取名建议
4. 跳过姓名分析

### 测试场景3：仅姓名分析

1. 输入出生信息
2. 查看八字、五行、命格分析
3. 跳过取名建议
4. 输入心仪的姓名进行分析

## 后续改进建议

1. **扩展姓名分析**
   - 添加姓名笔画吉凶判断
   - 添加姓名卦数分析
   - 添加姓名音律分析

2. **优化 LLM Prompt**
   - 改进评分标准
   - 添加更多约束条件
   - 提高分析质量

3. **增加对比功能**
   - 支持同时分析多个姓名
   - 生成对比报告
   - 排序推荐

4. **个性化建议**
   - 支持用户自定义评分标准
   - 支持用户自定义分析维度
   - 保存用户偏好
