# 用户指南

## 快速开始

### 安装依赖

```bash
# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
# Windows
venv\Scripts\activate
# Linux/Mac
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

### 配置环境变量

创建 `.env` 文件：

```
OPENAI_API_KEY=your_openai_api_key_here
```

### 运行程序

#### 命令行模式

```bash
python -m src.main
```

按照提示输入：
1. 出生时间（如：2024年3月15日10点30分）
2. 性别（男/女）
3. 历法类型（公历/农历，默认公历）

#### Python代码使用

```python
from bazi_calculator.chains.interactive_agent import InteractiveBaziNamingAgent

# 创建Agent
agent = InteractiveBaziNamingAgent(char_library_path="char_library.json")

# 运行交互式会话
agent.run_interactive_session("2024年3月15日10点30分", "男")
```

## 功能说明

### 八字计算

系统会根据出生时间计算八字四柱：

- **年柱**：以立春为界
- **月柱**：以节气为界，使用五虎遁法
- **日柱**：以1949年10月1日（甲子日）为基准推算
- **时柱**：使用五鼠遁法

### 五行分析

系统会分析八字五行：

- 统计四柱中五行的数量
- 分析日主强弱（强/中和/弱）
- 推算用神、喜神、忌神
- 识别缺失和过多的五行

### 取名建议

系统提供两种取名模式：

#### 精选模式（10个名字）

适合需要仔细分析的用户，每个名字包含：
- 详细的寓意解释
- 出处（《诗经》、《楚辞》等）
- 八字匹配度
- 五行配置
- 平仄分析
- 笔画分析
- 三才五格分析
- 综合评分

#### 批量模式（20-30个名字）

适合需要快速浏览的用户，每个名字包含：
- 简要寓意
- 五行匹配
- 平仄配置
- 笔画数
- 基础评分

批量模式支持两种生成方式：
1. **基于用户选择**：用户先选择心仪的字，系统基于这些字组合生成
2. **自动智能组合**：系统自动从适合字中智能组合

### 详细分析

用户可以选择任何感兴趣的名字进行详细分析，包括：

1. **八字五行匹配度**（35%权重）
   - 是否包含用神
   - 是否包含喜神
   - 是否包含忌神

2. **平仄和谐度**（25%权重）
   - 平仄模式
   - 音韵搭配

3. **笔画和谐度**（20%权重）
   - 总笔画
   - 平均笔画
   - 笔画分布

4. **三才五格吉凶**（20%权重）
   - 五格评分
   - 三才配置
   - 综合评分

综合评分 = 八字×35% + 平仄×25% + 笔画×20% + 三才五格×20%

## 使用技巧

### 时间格式

系统支持多种时间格式：

- 标准格式：2024年3月15日10点30分
- 简写格式：2024.3.15 10:30
- 纯数字格式：202403151030

### 适合字列表

系统会按五行优先级显示适合字：

1. 用神属性的字（最优先）
2. 喜神属性的字（次优先）
3. 缺失的五行字（可选补充）
4. 其他五行字

每个字显示：
- 拼音
- 五行属性
- 康熙笔画
- 平仄
- 寓意
- 评分

### 选择名字

系统支持循环分析多个名字：

1. 输入名字编号
2. 查看详细分析
3. 继续分析其他名字或退出

## 常见问题

### Q: 八字计算准确吗？

A: 本系统使用确定性算法计算八字：
- 年柱以立春为界
- 月柱以节气为界，使用五虎遁法
- 日柱以1949年10月1日为基准推算
- 时柱使用五鼠遁法

这些算法与传统命理学一致，计算结果准确可靠。

### Q: 如何选择最好的名字？

A: 建议综合考虑以下因素：
1. **八字匹配度**：优先选择包含用神的名字
2. **寓意美好**：选择寓意积极向上的字
3. **音韵和谐**：平仄搭配要顺畅
4. **书写美观**：笔画适中，分布均匀
5. **三才五格**：吉凶评分较高的

### Q: 批量取名和精选取名的区别？

A: 精选取名提供10个名字，每个都有详细分析，适合需要仔细斟酌的用户。批量取名提供20-30个名字，每个只有简要分析，适合需要快速浏览和比较的用户。

### Q: 可以同时考虑多个孩子的取名吗？

A: 可以！系统会为每个孩子独立计算八字和取名建议。您只需要为每个孩子输入不同的出生时间和性别即可。

### Q: 字库可以更新吗？

A: 字库会自动保存在 `char_library.json` 文件中。如果您想更新字库，可以：
1. 删除该文件
2. 重新运行程序，系统会自动生成新的字库

## 高级用法

### 自定义姓氏

默认使用"李"作为姓氏进行三才五格分析。如果您想使用其他姓氏：

```python
from bazi_calculator.tools.naming.sangcai_wuge import analyze_sancai_wuge

result = analyze_sancai_wuge.invoke({
    "name": "三",
    "surname": "张"  # 自定义姓氏
})
```

### 批量分析名字

```python
from bazi_calculator.tools.naming.comprehensive_analysis import compare_names_comprehensive

names = ["张三", "李四", "王五"]

# 批量比较
result = compare_names_comprehensive.invoke({
    "names": names,
    "bazi_analysis": bazi_analysis,
    "char_library": char_library,
    "surname": "张"
})

# 获取最佳名字
best_name = result["best"]
```

### 自定义字库

如果您有自己的字库，可以加载使用：

```python
import json
from bazi_calculator.data.char_database import CharacterDatabase

# 加载自定义字库
with open("custom_char_library.json", "r", encoding="utf-8") as f:
    custom_library = json.load(f)

# 使用自定义字库
db = CharacterDatabase()
db.set_char_library(custom_library)
```

## 输出解读

### 八字结果

```
==================================================
八字计算结果
==================================================

【出生信息】
出生时间：2024年3月15日 10时30分
性别：男
历法：公历

【八字四柱】
年柱：甲辰（木 土）
月柱：丁卯（火 木）节气：春分
日柱：戊辰（土 土）日主：戊
时柱：庚巳（金 火）

【五行统计】
木：2个
火：2个
土：2个
金：1个
水：0个

【日主分析】
日主：戊（土）
强弱：中和

【用神分析】
用神：火
喜神：土
忌神：金

==================================================
```

### 名字分析结果

```
=====================================================================
张三 - 综合凶吉分析
=====================================================================

【综合评分】
综合得分：85.5/100
综合评价：很好，推荐使用

【分项评分】
八字五行：85/100
平仄和谐：80/100
笔画和谐：88/100
三才五格：82/100

【详细分析】

1. 八字五行分析
   得分：85/100
   五行搭配较好
   ✅ 包含用神

2. 平仄分析
   得分：80/100
   模式：平仄
   平仄搭配较好
   ⚠️  平仄模式一般

3. 笔画分析
   得分：88/100
   总笔画：8画
   平均笔画：4.0画
   笔画搭配极佳，书写流畅美观

4. 三才五格分析
   得分：82/100
   三才配置：土土土（得分90）
   三才五格很好，较为吉利

【改进建议】
1. 平仄搭配不够和谐，建议调整平仄搭配
2. 各项分析都很好，这是一个优秀的名字

=====================================================================
```

## 性能优化建议

1. **首次运行**：首次运行会生成字库，可能需要1-2分钟
2. **后续运行**：字库会缓存在本地文件中，后续运行会更快
3. **批量取名**：批量生成20-30个名字可能需要5-10秒
4. **详细分析**：每个名字的详细分析需要1-2秒

## 技术支持

如有问题，请：
1. 查看 [API参考文档](API_REFERENCE.md)
2. 查看 [开发计划](../PLAN.md)
3. 提交Issue到项目仓库

## 下一步

- 查看 [API参考文档](API_REFERENCE.md) 了解详细API
- 查看 [开发计划](../PLAN.md) 了解未来功能
- 贡献代码到项目仓库
